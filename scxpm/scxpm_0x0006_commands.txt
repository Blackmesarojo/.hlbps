#if defined _scxpm_commands_included
    #endinput
#endif
#define _scxpm_commands_included

public SCXPM_Commands_Init()
{
    // Comandos de usuario
    register_clcmd("say /selectskills", "SCXPM_SelectSkills");
    register_clcmd("say /resetskills", "SCXPM_ResetSkills");
    register_clcmd("say /playerskills", "SCXPM_PlayerSkills");
    register_clcmd("say /skillsinfo", "SCXPM_SkillsInfo");
    
    // Comandos de admin
    register_concmd("scxpm_setlevel", "SCXPM_SetLevel", ADMIN_IMMUNITY);
    register_concmd("scxpm_addmedal", "SCXPM_AddMedal", ADMIN_IMMUNITY);
    register_concmd("scxpm_removemedal", "SCXPM_RemoveMedal", ADMIN_IMMUNITY);
    
    return PLUGIN_CONTINUE;
}

public SCXPM_SelectSkills(id)
{
    if(!is_user_connected(id) || !g_bLoaded[id])
        return PLUGIN_HANDLED;
        
    if(g_iSkillPoints[id] < 1)
    {
        client_print(id, print_chat, "[SCXPM] No tienes puntos de habilidad disponibles.");
        return PLUGIN_HANDLED;
    }
    
    show_skills_menu(id);
    return PLUGIN_CONTINUE;
}

public SCXPM_ResetSkills(id)
{
    if(!is_user_connected(id) || !g_bLoaded[id])
        return PLUGIN_HANDLED;
        
    // Resetear habilidades
    for(new skill = 1; skill <= MAX_SKILLS; skill++)
    {
        g_iSkillPoints[id] += g_iPlayerSkills[id][skill];
        g_iPlayerSkills[id][skill] = 0;
    }
    
    SCXPM_ApplySkills(id);
    client_print(id, print_chat, "[SCXPM] Tus habilidades han sido reseteadas. Tienes %d puntos disponibles.", g_iSkillPoints[id]);
    
    return PLUGIN_CONTINUE;
}

public SCXPM_SetLevel(id, level, target)
{
    if(!is_user_connected(id) || !(get_user_flags(id) & ADMIN_IMMUNITY))
        return PLUGIN_HANDLED;
        
    if(!is_user_connected(target))
    {
        client_print(id, print_chat, "[SCXPM] Jugador no válido.");
        return PLUGIN_HANDLED;
    }
    
    g_iLevel[target] = level;
    g_iSkillPoints[target] += level - g_iLevel[target];
    
    client_print(id, print_chat, "[SCXPM] Has establecido el nivel %d al jugador.", level);
    client_print(target, print_chat, "[SCXPM] Un admin ha establecido tu nivel a %d.", level);
    
    return PLUGIN_CONTINUE;
}

// Menú de habilidades
show_skills_menu(id)
{
    new menu[512], len;
    
    len = formatex(menu, charsmax(menu), "\yMenú de Habilidades^n");
    len += formatex(menu[len], charsmax(menu) - len, "\wPuntos disponibles: %d^n^n", g_iSkillPoints[id]);
    
    len += formatex(menu[len], charsmax(menu) - len, "\r1. \wSalud Extra \y[%d/50]^n", g_iPlayerSkills[id][SKILL_HEALTH]);
    len += formatex(menu[len], charsmax(menu) - len, "\r2. \wArmadura Extra \y[%d/50]^n", g_iPlayerSkills[id][SKILL_ARMOR]);
    len += formatex(menu[len], charsmax(menu) - len, "\r3. \wRegeneración HP \y[%d/50]^n", g_iPlayerSkills[id][SKILL_REGEN_HP]);
    len += formatex(menu[len], charsmax(menu) - len, "\r4. \wRegeneración AP \y[%d/50]^n", g_iPlayerSkills[id][SKILL_REGEN_AP]);
    len += formatex(menu[len], charsmax(menu) - len, "\r5. \wDistancia \y[%d/50]^n", g_iPlayerSkills[id][SKILL_DISTANCE]);
    
    show_menu(id, (1<<0)|(1<<1)|(1<<2)|(1<<3)|(1<<4)|(1<<9), menu, -1, "Skills Menu");
    return PLUGIN_HANDLED;
}